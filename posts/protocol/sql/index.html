<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>数据库开发 - 飘</title><meta name=Description content="This is my cool site"><meta property="og:title" content="数据库开发">
<meta property="og:description" content="数据库开发 数据库开发 win下 详细解释 原生接口 ODBC OLE ADO linux下 原生接口 ODBC sqlserver 优缺点 Docker安装sqlserver 官方文档 搜索镜像 docker search mssql 安装"><meta property="og:type" content="article"><meta property="og:url" content="https://www.wcq.life/posts/protocol/sql/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-08-28T15:17:52+00:00"><meta property="article:modified_time" content="2021-08-28T15:17:52+00:00"><meta property="og:site_name" content="My cool site"><meta name=twitter:card content="summary"><meta name=twitter:title content="数据库开发"><meta name=twitter:description content="数据库开发 数据库开发 win下 详细解释 原生接口 ODBC OLE ADO linux下 原生接口 ODBC sqlserver 优缺点 Docker安装sqlserver 官方文档 搜索镜像 docker search mssql 安装"><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://www.wcq.life/posts/protocol/sql/><link rel=prev href=https://www.wcq.life/posts/net/socket/><link rel=next href=https://www.wcq.life/posts/protocol/ssh/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"数据库开发","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.wcq.life\/posts\/protocol\/sql\/"},"genre":"posts","wordcount":1376,"url":"https:\/\/www.wcq.life\/posts\/protocol\/sql\/","datePublished":"2021-08-28T15:17:52+00:00","dateModified":"2021-08-28T15:17:52+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"作者"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"light"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"light"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=飘>飘</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>所有文章 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/emacs/index.html>Emacs </a><a class=menu-item href=/about>关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=飘>飘</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>所有文章</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/emacs/index.html title>Emacs</a><a class=menu-item href=/about title>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class="toc-content always-active" id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">数据库开发</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>作者</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2021-08-28>2021-08-28</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 1376 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 3 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#headline-1>数据库开发</a><ul><li><a href=#headline-2>win下</a></li><li><a href=#headline-3>linux下</a></li></ul></li><li><a href=#headline-4>sqlserver</a><ul><li><a href=#headline-5>优缺点</a></li><li><a href=#headline-6>Docker安装sqlserver</a></li><li><a href=#headline-7>sqlcmd用法</a></li><li><a href=#headline-8>unicode支持</a></li><li><a href=#headline-9>client 与 server</a></li><li><a href=#headline-10>遇到的奇怪的问题 && 解决思路</a></li></ul></li><li><a href=#headline-11>mysql</a></li><li><a href=#headline-12>ODBC</a></li><li><a href=#headline-13>常用数据库语句</a></li></ul></nav></div></div><div class=content id=content><p>数据库开发</p><div id=outline-container-headline-1 class=outline-2><h2 id=headline-1>数据库开发</h2><div id=outline-text-headline-1 class=outline-text-2><div id=outline-container-headline-2 class=outline-3><h3 id=headline-2>win下</h3><div id=outline-text-headline-2 class=outline-text-3><p><a href=https://www.bbsmax.com/A/kjdwDq7wzN/>详细解释</a></p><ol><li>原生接口</li><li>ODBC</li><li>OLE</li><li>ADO</li></ol></div></div><div id=outline-container-headline-3 class=outline-3><h3 id=headline-3>linux下</h3><div id=outline-text-headline-3 class=outline-text-3><ol><li>原生接口</li><li>ODBC</li></ol></div></div></div></div><div id=outline-container-headline-4 class=outline-2><h2 id=headline-4>sqlserver</h2><div id=outline-text-headline-4 class=outline-text-2><div id=outline-container-headline-5 class=outline-3><h3 id=headline-5>优缺点</h3></div><div id=outline-container-headline-6 class=outline-3><h3 id=headline-6>Docker安装sqlserver</h3><div id=outline-text-headline-6 class=outline-text-3><p><a href="https://docs.microsoft.com/zh-cn/sql/linux/quickstart-install-connect-docker?view=sql-server-2017&amp;pivots=cs1-bash">官方文档</a></p><ol><li>搜索镜像
docker search mssql</li><li>安装镜像(这个是官网的)
docker pull microsoft/mssql-server-linux</li><li>运行镜像, 创建容器
docker run -e "ACCEPT_EULA=Y" -e "SA_PASSWORD=hack@2020" -p 9988:1433 –name mssql -d microsoft/mssql-server-linux
注: 如果不指定映射的端口, 则可能随机使用一个端口
密码必须8位数, 否则会创建失败</li></ol><p>-p 第一个参数为主机端口, 第二参数为docker容器端口</p><ol><li>进入容器
docker exec -it mssql bash</li><li>测试sql server命令
/opt/mssql-tools/bin/sqlcmd -S localhost -U SA -P "passwd"</li><li>如果启动失败
docker logs mssql 查看日志信息</li></ol></div></div><div id=outline-container-headline-7 class=outline-3><h3 id=headline-7>sqlcmd用法</h3><div id=outline-text-headline-7 class=outline-text-3><ol><li><p>登录</p><pre class=example>
/opt/mssql-tools/bin/sqlcmd -S 127.0.0.1 -U SA -P &#34;hack@2020&#34;
</pre></li><li><p>执行语句查询</p><pre class=example>
select * from sys.databeses
go
</pre><p>一定记得使用go</p></li></ol></div></div><div id=outline-container-headline-8 class=outline-3><h3 id=headline-8>unicode支持</h3><div id=outline-text-headline-8 class=outline-text-3><pre class=example>
排序规则会影响字符集
</pre><ul><li>服务器 排序规则</li><li>数据库 排序规则</li><li>表中的字段 排序规则</li></ul><ol><li>排序规则会影响字符集, 比如排序规则为xx_UTF8, 那么其默认的字符集为unicode</li><li><p>nchar nvarchar类型会无视排序规则, 直接把改字段变为unicode编码</p><pre class=example>
使用的时候 记得加N, exp:  N&#39;排序规则&#39;
</pre></li></ol></div></div><div id=outline-container-headline-9 class=outline-3><h3 id=headline-9>client 与 server</h3><div id=outline-text-headline-9 class=outline-text-3><p>最理想的状态</p><ol><li>server 是 unicode编码(只要nchar, nvarchar即可)</li><li>client 是 unicode编码</li><li><p>unixodbc 编译的时候, 添加了 utf8的支持</p><pre class=example>
./configure --enable-iconv=yes --with-iconv-char-enc=UTF-8
</pre></li></ol><p>总结:
数据库表字段的编码,
服务器程序运行环境的编码,
unixodbc编译时候的字符编码
三者需要统一, 这样写入数据库的时候 才不会乱码</p><pre class=example>
服务器运行环境 locale可以查看
locale -a显示系统支持的字符集
</pre></div></div><div id=outline-container-headline-10 class=outline-3><h3 id=headline-10>遇到的奇怪的问题 && 解决思路</h3><div id=outline-text-headline-10 class=outline-text-3><p>简述: 通过odbc 操作sqlserver, 插入中文错误
现象:</p><ol><li>读取sqlserver中文正常</li><li>插入sqlserver中文乱码</li></ol><p>思路:</p><ol><li>查看sqlserver 的编码集(排序规则)</li><li><p>查看qy-server的运行环境</p><pre class=example>
locale
</pre></li><li>编译unixodbc的时候是否加入了编码的支持</li><li><p>查看odbc的配置文件</p><pre class=example>
odbcinst -j
这次的问题在于 odb的配置文件中 有重名的DSN
</pre></li></ol></div></div></div></div><div id=outline-container-headline-11 class=outline-2><h2 id=headline-11>mysql</h2><div id=outline-text-headline-11 class=outline-text-2><p>优点:
缺点:</p><ol><li>没有存储过程</li></ol></div></div><div id=outline-container-headline-12 class=outline-2><h2 id=headline-12>ODBC</h2><div id=outline-text-headline-12 class=outline-text-2><ol><li><p>安装odbc驱动</p><pre class=example>
建议使用官方源码安装 http://www.unixodbc.org
</pre><p>下载源码之后</p><pre class=example>
./configure --enable-gui=no --enable-iconv=yes --with-iconv-char-enc=UTF-8
./configure --enable-gui=no --enable-iconv=yes --with-iconv-char-enc=GB18030
这里需要添加中文支持, 不然会发生数据库读取中文正常, 写入中文时候乱码
</pre></li><li><p>安装对应的sql的驱动</p><pre class=example>
这里sql的驱动是 odbc下的sql驱动
</pre><p>以mssql为例. 在microsoft官网下载</p></li><li><p>查看sql的驱动信息</p><pre class=example>
debin在 /usr/local/etc/odbcinst.ini
</pre><pre class=example>
[ODBC Driver 17 for SQL Server]
Description=Microsoft ODBC Driver 17 for SQL Server
Driver=/opt/microsoft/msodbcsql17/lib64/libmsodbcsql-17.6.so.1.1
UsageCount=1
</pre><p>说明sql的驱动安装成功</p></li><li><p>编写DSN</p><pre class=example>
debin在 /usr/local/etc/odbc.ini
</pre><pre class=example>
[MssqlDB]
Driver = ODBC Driver 17 for SQL Server
Server = tcp:172.16.238.10,1433
</pre></li><li><p>测试安装</p><pre class=example>
# 查看odbc是否已经安装
odbcinst -j

# 查看驱动是否安装 odbcinst.ini
odbcinst -q -d

# 查看源是否安装 odbc.init
odbcinst -q -s
</pre></li><li><p>测试连接
上面安装测试完成之后, 测试连接</p><pre class=example>
isql MssqlDB user_name user_passwd -v
</pre><p>如果连接成功</p><pre class=example>
+---------------------------------------+
| Connected!                            |
|                                       |
| sql-statement                         |
| help [tablename]                      |
| quit                                  |
|                                       |
+---------------------------------------+
</pre><p>连接失败的可能分析</p><ul><li>先确认安装测试的3个命令执行正常</li><li><p>确认数据库的密码是否正确</p><pre class=example>
在数据库的容器中查看$SA_PASSWORD, 与本地的密码比较
</pre></li></ul></li></ol></div></div><div id=outline-container-headline-13 class=outline-2><h2 id=headline-13>常用数据库语句</h2><div id=outline-text-headline-13 class=outline-text-2><pre class=example>
sql server
</pre><ol><li><p>查询sql版本</p><pre class=example>
select @@version
go
</pre></li><li><p>查询支持的字符集</p><pre class=example>
只有2019版本 才支付utf-8字符集
</pre><pre class=example>
select * from ::fn_helpcollations()
go
</pre><p>查询当前系统的排序规则</p><pre class=example>
SELECT SERVERPROPERTY(&#39;Collation&#39;)
</pre><p>查询排序规则的字符集</p><pre class=example>
SELECT COLLATIONPROPERTY(&#39;Chinese_PRC_Stroke_CI_AI_KS_WS&#39;, &#39;CodePage&#39;)
</pre><pre class=example>
936 简体中文GBK 
950 繁体中文BIG5 
437 美国/加拿大英语 
932 日文 
949 韩文 
866 俄文 
65001 unicode UFT-8
</pre></li><li><p>查询所有的库</p><pre class=example>
select * from sys.databeses order by name
go
</pre><p>有时候显示的数据太多, 我们可以只显示需要的比如</p><pre class=example>
select name from sys.databeses order by name
go
</pre></li><li><p>查询当前数据库所有表</p><ol><li>方法一</li></ol></li></ol><pre class=example>
select * from sys.objects where type=&#39;U&#39;
go
</pre><p>–XType='U':表示所有用户表;
–XType='S':表示所有系统表;</p><ol><li>方法二</li></ol><pre class=example>
select * from sys.tables
go
</pre><ol><li>查询表中所有的字段
SELECT * FROM SysColumns WHERE id=Object_Id('TableName');</li></ol><p>SELECT COLLATIONPROPERTY('Chinese_PRC_CS_AS_WS', 'CodePage')</p><p>SELECT COLLATIONPROPERTY('Chinese_PRC_90_CI_AS_SC_UTF8', 'CodePage')
SELECT COLLATIONPROPERTY('Latin1_General_100_CI_AI_SC_UTF8', 'CodePage')
SELECT COLLATIONPROPERTY('SQL_Latin1_General_CP1_CI_AS', 'CodePage')
SELECT COLLATIONPROPERTY('Chinese_Simplified_Stroke_Order_100_CI_AI', 'CodePage')</p></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2021-08-28</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/net/socket/ class=prev rel=prev title=socket><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>socket</a>
<a href=/posts/protocol/ssh/ class=next rel=next title=ssh>ssh<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=/lib/lunr/lunr.stemmer.support.min.js></script><script type=text/javascript src=/lib/lunr/lunr.zh.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{},search:{highlightTag:"em",lunrIndexURL:"/index.json",lunrLanguageCode:"zh",lunrSegmentitURL:"/lib/lunr/lunr.segmentit.js",maxResultLength:20,noResultsFound:"没有找到结果",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>